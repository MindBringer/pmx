<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ§  AI Prompt Interface</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h2>ðŸ§  AI Prompt Interface</h2>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-target="tab-prompt">Fragen</button>
      <button class="tab" data-target="tab-docs">Dateien &amp; Audio</button>
      <button class="tab" data-target="tab-set" type="button">Einstellungen</button>
    </div>

    <!-- Panel: Prompt -->
    <div class="panel active" id="tab-prompt">
      <form id="prompt-form">
        <div class="form-group">
          <label for="prompt">Frage / Prompt:</label>
          <textarea id="prompt" placeholder="Stell eine Frage an das Modell..."></textarea>
        </div>

        <!-- Unterbereich: Anweisungen mit Sub-Tabs -->
        <div class="subtabs">
          <div class="subtab-bar">
            <button type="button" class="subtab active" data-target="subtab-sys">Systemverhalten</button>
            <button type="button" class="subtab" data-target="subtab-agents">Agenten/Personas</button>
          </div>

          <!-- Systemverhalten -->
          <div class="subpanel active" id="subtab-sys">
            <div class="form-group">
              <label for="model_sys">Modell:</label>
              <select id="model_sys">
                <option value="vllm">vLLM (lokal)</option>
                <option value="llama3">llama3 (lokal)</option>
                <option value="mistral">mistral (lokal)</option>
                <option value="mistralapi">Codestral API</option>
                <option value="groq">Groq API</option>
                <option value="openrouter">OpenRouter API</option>
                <option value="openai">OpenAI API</option>
                <option value="huggingface">Hugging Face API</option>
                <option value="anthropic">Anthropic API</option>
              </select>
            </div>

            <div class="form-group">
              <label for="system">Anweisungen fÃ¼r Systemverhalten (optional):</label>
              <textarea id="system" placeholder="sei ein hilfsbereiter Spezialist fÃ¼r..."></textarea>
            </div>
          </div>

          <!-- Agenten/Personas -->
          <div class="subpanel" id="subtab-agents">
            <div class="inline-help" style="margin:6px 0 12px">
              Aktiviere bis zu 5 Personas. Leere Felder werden ignoriert. Beispiel-Rollen helfen beim Start.
            </div>

            <!-- Ablauf: Runden -->
            <div class="persona-row" style="margin-top:10px">
              <span class="persona-head">Ablauf</span>
              <div class="row">
                <div class="form-group col" style="max-width:220px">
                  <label for="agent_rounds">Anzahl Runden</label>
                  <input type="number" id="agent_rounds" min="1" max="10" step="1" value="1"/>
                  <div class="inline-help">Wie viele DurchlÃ¤ufe die Personas diskutieren (1â€“10).</div>
                </div>
              </div>
            </div>

            <!-- Facilitator / Critic Auswahl -->
            <div class="persona-row">
              <span class="persona-head">Facilitator / Critic</span>
              <div class="row">
                <div class="form-group col">
                  <label for="critic_provider">Provider</label>
                  <select id="critic_provider">
                    <option value="">(Standard)</option>
                    <option value="groq">Groq API</option>
                    <option value="openai">OpenAI API</option>
                    <option value="anthropic">Anthropic API</option>
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="mistral">mistral</option>
                    <option value="llama3">llama3</option>
                  </select>
                </div>
                <div class="form-group col">
                  <label for="critic_model">Modell</label>
                  <input type="text" id="critic_model" placeholder="z. B. claude-3-5-sonnet oder llama-3.1-70b-versatile"/>
                  <div class="inline-help">Optional, wird je Provider automatisch gemappt.</div>
                </div>
              </div>
            </div>

            <!-- Writer Auswahl -->
            <div class="persona-row">
              <span class="persona-head">Writer</span>
              <div class="row">
                <div class="form-group col">
                  <label for="writer_provider">Provider</label>
                  <select id="writer_provider">
                    <option value="">(Standard)</option>
                    <option value="groq">Groq API</option>
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="openai">OpenAI API</option>
                    <option value="anthropic">Anthropic API</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="mistral">mistral</option>
                    <option value="llama3">llama3</option>
                  </select>
                </div>
                <div class="form-group col">
                  <label for="writer_model">Modell</label>
                  <input type="text" id="writer_model" placeholder="z. B. gpt-4o-mini oder llama-3.1-70b-versatile"/>
                  <div class="inline-help">Optional, wird je Provider automatisch gemappt.</div>
                </div>
              </div>
            </div>

            <!-- Personas 1â€“5 -->
            <div class="persona-row">
              <label class="persona-head"><input type="checkbox" id="p1_enabled" /> Persona 1</label>
              <div class="row">
                <div class="form-group col">
                  <label for="p1_label">Jobtitel / Beschreibung</label>
                  <input type="text" id="p1_label" placeholder="z. B. Buchhalter â€“ Kosten & Risiken prÃ¼fen" />
                </div>
                <div class="form-group col">
                  <label for="p1_model">Modell</label>
                  <select id="p1_model">
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="groq">Groq API</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="llama3">llama3</option>
                    <option value="mistral">mistral</option>
                    <option value="openai">OpenAI API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="anthropic">Anthropic API</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="persona-row">
              <label class="persona-head"><input type="checkbox" id="p2_enabled" /> Persona 2</label>
              <div class="row">
                <div class="form-group col">
                  <label for="p2_label">Jobtitel / Beschreibung</label>
                  <input type="text" id="p2_label" placeholder="z. B. IT-Spezialist â€“ Architektur & Aufwand" />
                </div>
                <div class="form-group col">
                  <label for="p2_model">Modell</label>
                  <select id="p2_model">
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="groq">Groq API</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="llama3">llama3</option>
                    <option value="mistral">mistral</option>
                    <option value="openai">OpenAI API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="anthropic">Anthropic API</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="persona-row">
              <label class="persona-head"><input type="checkbox" id="p3_enabled" /> Persona 3</label>
              <div class="row">
                <div class="form-group col">
                  <label for="p3_label">Jobtitel / Beschreibung</label>
                  <input type="text" id="p3_label" placeholder="z. B. Vertrieb â€“ Kundennutzen & Upsell" />
                </div>
                <div class="form-group col">
                  <label for="p3_model">Modell</label>
                  <select id="p3_model">
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="groq">Groq API</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="llama3">llama3</option>
                    <option value="mistral">mistral</option>
                    <option value="openai">OpenAI API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="anthropic">Anthropic API</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="persona-row">
              <label class="persona-head"><input type="checkbox" id="p4_enabled" /> Persona 4</label>
              <div class="row">
                <div class="form-group col">
                  <label for="p4_label">Jobtitel / Beschreibung</label>
                  <input type="text" id="p4_label" placeholder="z. B. Recht â€“ Compliance & DSGVO" />
                </div>
                <div class="form-group col">
                  <label for="p4_model">Modell</label>
                  <select id="p4_model">
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="groq">Groq API</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="llama3">llama3</option>
                    <option value="mistral">mistral</option>
                    <option value="openai">OpenAI API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="anthropic">Anthropic API</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="persona-row">
              <label class="persona-head"><input type="checkbox" id="p5_enabled" /> Persona 5</label>
              <div class="row">
                <div class="form-group col">
                  <label for="p5_label">Jobtitel / Beschreibung</label>
                  <input type="text" id="p5_label" placeholder="z. B. Einkauf â€“ Angebote & RahmenvertrÃ¤ge" />
                </div>
                <div class="form-group col">
                  <label for="p5_model">Modell</label>
                  <select id="p5_model">
                    <option value="vllm">vLLM (lokal)</option>
                    <option value="groq">Groq API</option>
                    <option value="mistralapi">Codestral API</option>
                    <option value="openrouter">OpenRouter API</option>
                    <option value="llama3">llama3</option>
                    <option value="mistral">mistral</option>
                    <option value="openai">OpenAI API</option>
                    <option value="huggingface">Hugging Face API</option>
                    <option value="anthropic">Anthropic API</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Senden -->
        <div class="form-group">
          <label>Firmendaten mit einbeziehen?</label>
          <div class="choices" id="rag-choices">
            <label class="choice active"><input type="radio" name="rag" value="false" checked> Nein</label>
            <label class="choice"><input type="radio" name="rag" value="true"> Ja</label>
          </div>
          <div class="inline-help">Wenn â€žJaâ€œ, wird <code>rag=true</code> an <code>/webhook/llm</code> Ã¼bergeben.</div>
        </div>

        <div class="btn-grid">
          <button type="submit" id="submit-btn">Senden</button>
        </div>
        <div id="conv-status" class="inline-help" style="margin:8px 0"></div>
      </form>

      <!-- Live-Status & Spinner (PROMPT) -->
      <section id="job-status" class="result-box" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Live-Status</div>
        <div id="job-title" style="margin-bottom:4px;">â€”</div>
        <div id="job-statusline" style="margin-bottom:8px;">Warte auf Start â€¦</div>
        <div id="job-log" class="mono" style="border:1px solid #ddd; padding:8px; max-height:240px; overflow:auto; background:#fafafa; font-size: 12px;"></div>
      </section>

      <div class="loading-container" id="spinner" style="display:none">
        <div class="spinner"></div>
        <div class="loading-text">Ich arbeite<span class="dots"></span></div>
      </div>

      <!-- Antwortbereich (PROMPT) -->
      <div id="result" class="result-box">
        <div id="result-output"></div>
      </div>
    </div>

    <!-- Panel: Dateien & Audio -->
    <div class="panel" id="tab-docs">
      <!-- --- Datei-Upload --- -->
      <form id="docs-form">
        <div class="row">
          <div class="form-group col">
            <label for="file">Datei auswÃ¤hlen</label>
            <input type="file" id="file" multiple />
            <div class="inline-help">UnterstÃ¼tzt: txt, md, pdf, html, docx, odt, xlsx, eml</div>
          </div>
          <div class="form-group col">
            <label for="tags">Tags</label>
            <input type="text" id="tags" placeholder="z. B. projektX,angebot,intern" />
            <div class="inline-help">(optional, Komma-getrennt)</div>
          </div>
        </div>

        <div class="btn-grid cols-2">
          <button type="submit" id="upload-btn">Hochladen</button>
        </div>
      </form>

      <div id="upload-result" class="upload-box">
        <div id="upload-output"></div>
        <div class="loading-container" id="upload-spinner" style="display:none">
          <div class="spinner"></div>
          <div class="loading-text">Lade hoch<span class="dots"></span></div>
        </div>
      </div>

      <div style="height:1px;background:#eee;margin:18px 0"></div>

      <!-- --- Audio Upload (Transcribe & Diarization & optional Summary) --- -->
      <form id="audio-form">
        <div class="form-group">
          <label for="audioFile">Audio auswÃ¤hlen</label>
          <input type="file" id="audioFile" accept="audio/*" />
          <div class="inline-help">UnterstÃ¼tzt: wav, mp3, m4a, ogg, webm, flac</div>
        </div>

        <div class="row">
          <div class="form-group col">
            <label><input type="checkbox" id="doDiar" checked/> Sprecher trennen (Diarization)</label>
            <div class="inline-help">Segmentiert Sprecher unabhÃ¤ngig von Namen.</div>
          </div>
          <div class="form-group col">
            <label><input type="checkbox" id="doIdentify" checked/> Personen identifizieren</label>
            <div class="inline-help">Versucht bekannte Personen zuzuordnen.</div>
          </div>
        </div>

        <!-- Zusammenfassung + Modellwahl -->
        <div class="row">
          <div class="form-group col">
            <label><input type="checkbox" id="audioSummarize" checked/> Zusammenfassung erstellen</label>
          </div>
          <div class="form-group col">
            <label for="audioModel">Modell</label>
            <select id="audioModel">
              <option value="vllm">vLLM (lokal)</option>
              <option value="groq">Groq API</option>
              <option value="mistralapi">Codestral API</option>
              <option value="openrouter">OpenRouter API</option>
              <option value="llama3">llama3</option>
              <option value="mistral">mistral</option>
              <option value="openai">OpenAI API</option>
              <option value="huggingface">Hugging Face API</option>
              <option value="anthropic">Anthropic API</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="form-group col">
            <label for="speakerHints">Speaker Hints (optional)</label>
            <input type="text" id="speakerHints" placeholder="alice,bob" />
            <div class="inline-help">Bevorzugte Kandidaten (Komma-getrennt).</div>
          </div>

          <div class="form-group col">
            <label for="audioTags">Tags</label>
            <input type="text" id="audioTags" placeholder="z. B. meeting,vertrieb,2025-08-14" />
            <div class="inline-help">(optional, Komma-getrennt; wird an die Transkription gehÃ¤ngt)</div>
          </div>
        </div>

        <div class="btn-grid cols-2">
          <button type="submit" id="audio-upload-btn">Audio hochladen &amp; transkribieren</button>
        </div>
      </form>

      <!-- Mic controls (Transcribe) -->
      <div class="row">
        <div class="form-group col">
          <label>Mikrofon</label>
          <select id="micSelectTrans"></select>
          <div class="inline-help" id="micStatusTrans">â€“</div>
        </div>
        <div class="form-group col">
          <label>Aufnahme</label>
          <div class="btn-grid cols-2">
            <button type="button" id="micCheckTrans" class="secondary">Hardware prÃ¼fen</button>
            <button type="button" id="micStartTrans">Aufnehmen</button>
            <button type="button" id="micStopTrans" class="secondary" disabled>Stop</button>
          </div>
          <div class="inline-help">
            <span id="micTimerTrans">00:00</span>
          </div>
          <div class="meter"><i id="micMeterTrans"></i></div>
        </div>
      </div>

      <!-- Live-Status & Spinner (DOCS/AUDIO) -->
      <section id="job-status-docs" class="result-box" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Live-Status</div>
        <div id="job-title-docs" style="margin-bottom:4px;">â€”</div>
        <div id="job-statusline-docs" style="margin-bottom:8px;">Warte auf Start â€¦</div>
        <div id="job-log-docs" class="mono" style="border:1px solid #ddd; padding:8px; max-height:240px; overflow:auto; background:#fafafa; font-size: 12px;"></div>
      </section>

      <div class="loading-container" id="spinner-docs" style="display:none">
        <div class="spinner"></div>
        <div class="loading-text">Ich arbeite<span class="dots"></span></div>
      </div>

      <!-- Antwortbereich (DOCS/AUDIO) -->
      <div id="result-docs" class="upload-box">
        <div id="result-output-docs"></div>
      </div>

      <!-- Bekannte Sprecher (im DOCS/AUDIO Tab) -->
      <div class="upload-box" style="margin-top:12px">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
          <div><b>Bekannte Sprecher</b></div>
          <button type="button" id="speaker-refresh-btn-docs" class="secondary" style="width:auto">Liste aktualisieren</button>
        </div>
        <div id="speaker-list-docs" class="timeline" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- Panel: Einstellungen -->
    <div class="panel" id="tab-set">
      <div class="form-group">
        <label for="apiKey">API-Key (RAG)</label>
        <div class="row" style="gap:8px;align-items:center">
          <input type="password" id="apiKey" placeholder="x-api-key fÃ¼r RAG-Backend (z. B. change-me)" class="col" />
          <button type="button" id="toggleKey" class="secondary" style="flex:0 0 auto">anzeigen</button>
        </div>
        <div class="inline-help">Wird in <code>localStorage</code> gespeichert.</div>
      </div>

      <!-- --- Sprecherverwaltung (Enrollment) --- -->
      <div style="height:1px;background:#eee;margin:18px 0"></div>
      <form id="speaker-form">
        <div class="form-group">
          <label for="speakerName">Name des Sprechers</label>
          <input type="text" id="speakerName" placeholder="z. B. Alice MÃ¼ller" />
          <div class="inline-help">Nutze exakt denselben Namen, der spÃ¤ter zur Anzeige verwendet werden soll.</div>
        </div>
        <div class="form-group">
          <label for="speakerFile">Referenz-Audio fÃ¼r Enrollment</label>
          <input type="file" id="speakerFile" accept="audio/*" />
          <div class="inline-help">Empfohlen: 10â€“30 Sek. klare Sprache.</div>
        </div>

        <!-- Mic controls (Enroll) -->
        <div class="row">
          <div class="form-group col">
            <label>Mikrofon</label>
            <select id="micSelectEnroll"></select>
            <div class="inline-help" id="micStatusEnroll">â€“</div>
          </div>
          <div class="form-group col">
            <label>Aufnahme</label>
            <div class="btn-grid cols-2">
              <button type="button" id="micCheckEnroll" class="secondary">Hardware prÃ¼fen</button>
              <button type="button" id="micStartEnroll">Aufnehmen</button>
              <button type="button" id="micStopEnroll" class="secondary" disabled>Stop</button>
            </div>
            <div class="inline-help">
              <span id="micTimerEnroll">00:00</span>
            </div>
            <div class="meter"><i id="micMeterEnroll"></i></div>
          </div>
        </div>

        <div class="btn-grid cols-2">
          <button type="submit" id="speaker-enroll-btn">Sprecher hinzufÃ¼gen</button>
        </div>
      </form>

      <div id="speaker-result" class="upload-box">
        <div id="speaker-output"></div>
        <div class="loading-container" id="speaker-spinner" style="display:none">
          <div class="spinner"></div>
          <div class="loading-text">Speichere<span class="dots"></span></div>
        </div>
      </div>

      <!-- Bekannte Sprecher (im EINSTELLUNGEN Tab) -->
      <div class="upload-box" style="margin-top:12px">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
          <div><b>Bekannte Sprecher</b></div>
          <button type="button" id="speaker-refresh-btn-settings" class="secondary" style="width:auto">Liste aktualisieren</button>
        </div>
        <div id="speaker-list-settings" class="timeline" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
