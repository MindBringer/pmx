{
  "nodes": [
    {
      "id": "webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [100, 300],
      "parameters": {
        "httpMethod": "POST",
        "path": "llm",
        "responseMode": "lastNode"
      }
    },
    {
      "id": "inputCheck",
      "name": "Input Check",
      "type": "n8n-nodes-base.code",
      "position": [300, 300],
      "parameters": {
        "code": "const { prompt, model, openai_api_key = null } = $json;\n\nif (!prompt || !model) {\n  throw new Error('prompt and model required');\n}\n\nreturn [{\n  json: {\n    prompt,\n    model,\n    openai_api_key\n  }\n}];"
      }
    },
    {
      "id": "switchModel",
      "name": "Switch Model",
      "type": "n8n-nodes-base.switch",
      "position": [500, 300],
      "parameters": {
        "value1": "={{ $json.model }}",
        "rules": [
          {
            "operation": "equal",
            "value2": "openai"
          },
          {
            "operation": "equal",
            "value2": "ollama"
          }
        ]
      }
    },
    {
      "id": "callOpenAI",
      "name": "Call OpenAI",
      "type": "n8n-nodes-base.httpRequest",
      "position": [700, 200],
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "method": "POST",
        "authentication": "predefinedCredentialType",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\n  \"model\": \"gpt-4\",\n  \"messages\": [\n    { \"role\": \"user\", \"content\": \"{{ $json.prompt }}\" }\n  ]\n}",
        "headerParametersJson": "={\n  \"Authorization\": \"Bearer {{$json.openai_api_key}}\",\n  \"Content-Type\": \"application/json\"\n}"
      },
      "credentials": {
        "httpBasicAuth": {
          "id": "__REPLACE__",
          "name": "__REPLACE__"
        }
      }
    },
    {
      "id": "callOllama",
      "name": "Call Ollama",
      "type": "n8n-nodes-base.httpRequest",
      "position": [700, 400],
      "parameters": {
        "url": "http://ollama:11434/api/generate",
        "method": "POST",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\n  \"model\": \"mistral\",\n  \"prompt\": \"{{$json.prompt}}\"\n}"
      }
    },
    {
      "id": "wrapResponse",
      "name": "Wrap Response",
      "type": "n8n-nodes-base.code",
      "position": [900, 300],
      "parameters": {
        "code": "return [\n  {\n    json: {\n      response: $json.response || $json.choices?.[0]?.message?.content || $json.output || $json,\n      source: $json.model || (typeof $json.choices !== 'undefined' ? 'openai' : 'ollama')\n    }\n  }\n];"
      }
    },
    {
      "id": "respondWebhook",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.noOp",
      "position": [1100, 300]
    }
  ],
  "connections": {
    "webhook": {
      "main": [["inputCheck"]]
    },
    "inputCheck": {
      "main": [["switchModel"]]
    },
    "switchModel": {
      "main": [
        ["callOpenAI"],
        ["callOllama"]
      ]
    },
    "callOpenAI": {
      "main": [["wrapResponse"]]
    },
    "callOllama": {
      "main": [["wrapResponse"]]
    },
    "wrapResponse": {
      "main": [["respondWebhook"]]
    }
  }
}
